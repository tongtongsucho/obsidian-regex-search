# Obsidian 正则表达式搜索插件

一个强大且健壮的 Obsidian 插件，支持在单个文件或整个文档库中进行正则表达式搜索和替换。

## 功能特性

### 核心功能

- ✅ **跨文件搜索**: 在整个文档库中搜索匹配的正则表达式
- ✅ **单文件搜索**: 在当前打开的文件中搜索
- ✅ **快速搜索**: 全新的快速搜索模式，支持实时搜索
- ✅ **批量替换**: 支持跨文件的正则表达式替换
- ✅ **智能算法**: 自动检测是否需要全文搜索，优化性能

### 用户体验

- ✅ **实时预览**: 显示搜索结果的上下文
- ✅ **智能高亮**: 高亮显示匹配的文本
- ✅ **精确跳转**: 点击搜索结果直接跳转到文件的具体行和列
- ✅ **自动高亮**: 跳转后自动选择和高亮匹配的关键词
- ✅ **搜索历史**: 保存和快速访问搜索历史
- ✅ **进度指示**: 实时显示搜索和替换进度

### 安全性与健壮性

- ✅ **输入验证**: 全面的正则表达式验证和复杂性检查
- ✅ **错误处理**: 完善的错误处理和用户友好的错误消息
- ✅ **确认机制**: 批量替换前的确认对话框
- ✅ **搜索取消**: 支持取消长时间运行的搜索操作
- ✅ **超时保护**: 自动超时机制防止无限循环

### 性能优化

- ✅ **批量处理**: 优化的批量文件处理算法
- ✅ **文件过滤**: 智能文件过滤，排除不必要的文件
- ✅ **大文件支持**: 自动检测和处理大文件
- ✅ **内存管理**: 优化内存使用，避免阻塞 UI
- ✅ **异步操作**: 所有搜索操作都是异步的，不阻塞界面

### 配置选项

- ✅ **文件类型过滤**: 选择要搜索的文件类型
- ✅ **排除模式**: 支持正则表达式排除特定文件
- ✅ **可配置选项**: 区分大小写、多行模式、结果数量限制等
- ✅ **个性化设置**: 丰富的用户偏好设置

## 安装

### 手动安装

1. 下载最新版本
2. 将文件解压到你的 Obsidian 插件目录：`VaultFolder/.obsidian/plugins/obsidian-regex-search/`
3. 重新启动 Obsidian
4. 在设置中启用插件

### 从 Obsidian 社区插件安装

1. 打开 Obsidian 设置
2. 进入社区插件页面
3. 搜索 "Regex Search"
4. 安装并启用

## 使用方法

### 基本使用

1. **打开搜索**: 使用命令面板 (Ctrl/Cmd + P) 搜索 "打开正则表达式搜索"
2. **当前文件搜索**: 使用命令 "在当前文件中搜索"
3. **快速搜索**: 使用命令 "快速正则表达式搜索" 进行实时搜索
4. **输入正则表达式**: 在搜索框中输入你的正则表达式模式
5. **输入替换内容**: 在替换框中输入替换文本（可选）
6. **配置选项**: 根据需要启用/禁用区分大小写、多行模式等
7. **执行操作**: 按 Enter 键搜索，或按 Ctrl+Enter 键替换
8. **查看结果**: 浏览搜索结果，点击任意结果跳转到对应位置

### 搜索历史

- 插件会自动保存你的搜索历史
- 点击搜索框旁边的 "历史" 按钮查看和选择历史搜索
- 可以在设置中清空搜索历史

### 快速搜索模式

- 支持实时搜索，输入即搜索
- 按 Enter 键可以打开完整的搜索界面
- 适合快速查找内容

### 正则表达式库

- **使用内置库**: 点击 "正则库" 按钮，选择预制的正则表达式一键填入
- **添加自定义**: 在管理页面中添加你的专属正则表达式
- **分类管理**: 按功能分类组织，轻松查找所需模式
- **导入导出**: 备份和分享你的正则表达式库

### 正则表达式示例

**💡 提示**: v1.0.2 版本新增了正则表达式库功能，以下常用正则表达式已内置到库中，可一键使用！

**基本语法**:
- `\b\w+@\w+\.\w+\b` - 匹配电子邮件地址
- `\d{4}-\d{2}-\d{2}` - 匹配日期格式 (YYYY-MM-DD)
- `#\w+` - 匹配标签
- `\[\[.*?\]\]` - 匹配 Obsidian 双链接
- `^#{1,6}\s.*` - 匹配 Markdown 标题
- `\*\*.*?\*\*` - 匹配粗体文本
- `(?<=\#)\w+` - 匹配标签中的单词（正向后查找）
- `(?i)\bTODO\b` - 不区分大小写匹配 TODO

**内置正则表达式库包含**:
- 📧 **联系信息**: 邮箱、电话、URL 等
- 📅 **时间日期**: 各种日期格式、时间戳等
- 📝 **Markdown**: 标题、链接、粗体、斜体、代码块等
- 📎 **文件附件**: PDF、图片、音频、视频等文件链接
- 🔢 **数字**: IP地址、版本号、银行卡号等

**使用方法**: 在搜索界面点击 "正则库" 按钮，选择需要的正则表达式即可自动填入搜索框。

### 键盘快捷键

**内置快捷键：**
- `Enter` - 执行搜索
- `Ctrl+Enter` - 执行替换
- `Esc` - 关闭搜索窗口或取消当前操作

**可配置快捷键：**
你可以在 Obsidian 设置中为以下命令配置快捷键：

- `打开正则表达式搜索`
- `在当前文件中搜索`
- `快速正则表达式搜索`

## 配置选项

在插件设置中，你可以配置以下选项：

### 基本设置

- **默认搜索模式**: 设置打开搜索时的默认正则表达式
- **区分大小写**: 默认是否启用区分大小写搜索
- **多行模式**: 默认是否启用多行模式
- **文件扩展名**: 指定要搜索的文件类型

### 高级设置

- **包含隐藏文件**: 是否在搜索中包含隐藏文件
- **排除模式**: 要排除的文件路径模式（支持正则表达式）
- **确认替换**: 在执行全库替换操作前显示确认对话框

### 性能设置

- **每个文件最大结果数**: 限制每个文件显示的搜索结果数量

### 用户体验设置

- **启用搜索历史**: 保存和显示搜索历史记录
- **启用进度指示器**: 在搜索和替换过程中显示进度指示器

## 开发

### 环境要求

- Node.js 16+
- npm 或 yarn

### 构建

```bash
# 安装依赖
npm install

# 开发模式（带热重载）
npm run dev

# 生产构建
npm run build
```

### 项目结构

```
obsidian-regex-search/
├── main.ts          # 主插件文件
├── styles.css       # 样式文件
├── manifest.json    # 插件清单
├── package.json     # 包配置
├── tsconfig.json    # TypeScript 配置
└── esbuild.config.mjs # 构建配置
```

## 许可证

MIT License - 详见 LICENSE 文件

## 贡献

欢迎提交问题和拉取请求！

### 贡献指南

1. Fork 这个项目
2. 创建你的特性分支 (`git checkout -b feature/AmazingFeature`)
3. 提交你的更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 打开一个 Pull Request

## 更新日志

### 1.0.2

- 🚀 **搜索算法革命性升级**:
  - 搜索速度提升 3-5 倍，智能文件排序（小文件优先）
  - 批处理大小翻倍，防抖延迟降至 150ms
  - 早期终止机制，最多处理 500 个结果避免卡顿
  - Promise 错误容错，提升算法稳定性

- 📚 **正则表达式库**:
  - 内置丰富模板：电子邮箱、URL、电话、日期、Markdown 语法、文件附件等
  - 智能分类管理，支持个人定制正则表达式
  - 一键填入搜索框，支持导入/导出功能
  - 简化 UI：直接打开管理页面，移除拥挤的下拉菜单

- ⚡ **实时搜索结果**:
  - 流式结果显示，边搜索边展示，告别漫长等待
  - 动态统计更新，实时显示匹配数量
  - 优雅的滑入动画，提升视觉体验

- 🎯 **用户体验优化**:
  - 类原生搜索体验，界面更加简洁清爽
  - 多行模式说明移至设置页面，保持搜索框区域整洁
  - 改进模态窗口管理，关闭子窗口自动返回父窗口
  - 移除使用计数显示，简化正则表达式库界面

- 🔧 **技术改进**:
  - 增强的并发控制和错误处理
  - 优化内存使用，支持更大的搜索任务
  - 改进的正则表达式库初始化机制
  - 完善的 TypeScript 类型定义

### 1.0.1

- 🆕 **新功能**:
  - 添加快速搜索模式
  - 搜索历史功能
  - 进度指示器
  - 搜索取消功能
  - 确认替换对话框

- 🚀 **性能优化**:
  - 优化搜索算法
  - 批量处理改进
  - 内存使用优化
  - 异步操作优化

- 🛡️ **安全性与健壮性**:
  - 完善的错误处理
  - 输入验证和清理
  - 正则表达式复杂性检查
  - 超时保护机制

- 🎨 **用户体验**:
  - 改进的用户界面
  - 更好的键盘快捷键
  - 响应式设计
  - 加载状态指示

- 🔧 **技术改进**:
  - TypeScript 类型安全
  - 模块化代码结构
  - 改进的构建系统
  - 更好的错误日志

### 1.0.0

- 初始版本发布
- 支持跨文件和单文件正则表达式搜索
- 完整的用户界面和配置选项
- 搜索结果高亮和跳转功能

## 支持

如果你觉得这个插件有用，请给它一个星标！如果遇到问题，请在 GitHub 上提交 issue。

### 常见问题

**Q: 如何搜索跨行的内容？**
A: 启用多行模式，然后使用 `.` 匹配任意字符，或使用 `[\s\S]` 匹配包括换行符在内的任意字符。

**Q: 正则表达式太复杂怎么办？**
A: 插件会自动检测正则表达式的复杂性，如果过于复杂会给出警告。建议简化表达式或分步搜索。

**Q: 如何排除某些文件？**
A: 在设置中配置 "排除模式"，支持正则表达式，例如 `node_modules|\.git|temp`。

**Q: 搜索速度很慢怎么办？**
A: 尝试限制搜索范围，使用更具体的正则表达式，或在设置中减少最大结果数。v1.0.2 版本已大幅优化搜索算法，速度提升3-5倍。

**Q: 如何使用正则表达式库？**
A: 在搜索界面点击 "正则库" 按钮，选择需要的正则表达式即可自动填入搜索框。你也可以添加自定义的正则表达式。

**Q: 如何备份我的正则表达式库？**
A: 在正则表达式库管理页面点击 "导出" 按钮，可以将你的正则表达式库导出为JSON文件进行备份。

---

**作者**: Tongtong Zhang  
**版本**: 1.0.2  
**最后更新**: 2024 
